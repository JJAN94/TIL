# 2일차 몽고DB

비정형 데이터를 분산시스템을 이용해서 복제를 구현해준다.

샤딩을 이용해 복제를 하는데 config server라는게 있어서 해당 데이터를 구현해서 연동할 수 있는 부분을 가지고 있는 특징이 있다. (?뭔소리여?)





---

수업

---

컬렉션 생성, 연산자 활용, 집계



- show  collections

```javascript
> show collections

exam
exam02
exam03
my
nums
```



- use my_score

```javascript
> use my_score
```





- Score 컬렉션 생성

```javascript
> db.Score.insert({name:"aaa", kor:90, eng:80, mat:98, test:"midterm"})
> db.Score.insert({name:"bbb", kor:100, eng:100, mat:76, test:"final"})
> db.Score.insert({name:"ccc", kor:80, eng:55, mat:67, test:"midterm"})
> db.Score.insert({name:"ddd", kor:70, eng:69, mat:89, test:"midterm"})
> db.Score.insert({name:"eee", kor:60, eng:80, mat:78, test:"final"})
> db.Score.insert({name:"fff", kor:100, eng:69, mat:89, test:"midterm"})
> db.Score.insert({name:"ggg", kor:75, eng:100, mat:100, test:"final"})

> db.Score.find()
{ "_id" : ObjectId("60c70b7ac7da1198bbf19e1a"), "name" : "aaa", "kor" : 90, "eng" : 80, "mat" : 98, "test" : "midterm" }
{ "_id" : ObjectId("60c70b7ac7da1198bbf19e1b"), "name" : "bbb", "kor" : 100, "eng" : 100, "mat" : 76, "test" : "final" }
{ "_id" : ObjectId("60c70b7ac7da1198bbf19e1c"), "name" : "ccc", "kor" : 80, "eng" : 55, "mat" : 67, "test" : "midterm" }
{ "_id" : ObjectId("60c70b7ac7da1198bbf19e1d"), "name" : "ddd", "kor" : 70, "eng" : 69, "mat" : 89, "test" : "midterm" }
{ "_id" : ObjectId("60c70b7ac7da1198bbf19e1e"), "name" : "eee", "kor" : 60, "eng" : 80, "mat" : 78, "test" : "final" }
{ "_id" : ObjectId("60c70b7ac7da1198bbf19e1f"), "name" : "fff", "kor" : 100, "eng" : 69, "mat" : 89, "test" : "midterm" }
{ "_id" : ObjectId("60c70b7bc7da1198bbf19e20"), "name" : "ggg", "kor" : 75, "eng" : 100, "mat" : 100, "test" : "final" }


> db.Score.help()
```





- count() / distinct() / sort(): -1이 내림차순 / limit()



- group({key, reduce, initial, \[keyf]\[cond], finalize})
  - key : 필드 이름
  - reduce : 그룹으로 묶은 문서에 집합연산
  - initial : reduce의 result의 초기값을 지정하는 것
  - keyf : key 필드를 대처하는 자바스크립트 객체
  - cond : 특정 조건에 맞는 문서의 그룹
  - finalize : 최종값 계산 결과(reduce의 결과)









db.Score.count( query = {}, <optional params> ) - count the number of documents that matches the query, optional parameters are: limit, skip, hint, maxTimeMS

db.Score.find(...).count()
db.Score.find(...).limit(n) n개 limit, skip
db.Score.find(...).skip(n)
db.Score.find(...).sort(...)



Q1. Score의 전체 출력을 해보고 문서의 개수를 구하자.

```javascript
> db.Score.find()
> db.Score.find().count()

7
```



Q2. Score의 이름과 수학점수만 출력해보자.

```javascript
> db.Score.find({}, {name:1, mat:1, _id:0})

{ "name" : "aaa", "mat" : 98 }
{ "name" : "bbb", "mat" : 76 }
{ "name" : "ccc", "mat" : 67 }
{ "name" : "ddd", "mat" : 89 }
{ "name" : "eee", "mat" : 78 }
{ "name" : "fff", "mat" : 89 }
{ "name" : "ggg", "mat" : 100 }
```



Q3. Score 수학점수 중 70점 이상만 출력 해보자.

```javascript
> db.Score.find({mat:{$gte:70}})
// 수학점수가 70점 이상인 사람은?
{ "_id" : ObjectId("60c70b7ac7da1198bbf19e1a"), "name" : "aaa", "kor" : 90, "eng" : 80, "mat" : 98, "test" : "midterm" }
{ "_id" : ObjectId("60c70b7ac7da1198bbf19e1b"), "name" : "bbb", "kor" : 100, "eng" : 100, "mat" : 76, "test" : "final" }
{ "_id" : ObjectId("60c70b7ac7da1198bbf19e1d"), "name" : "ddd", "kor" : 70, "eng" : 69, "mat" : 89, "test" : "midterm" }
{ "_id" : ObjectId("60c70b7ac7da1198bbf19e1e"), "name" : "eee", "kor" : 60, "eng" : 80, "mat" : 78, "test" : "final" }
{ "_id" : ObjectId("60c70b7ac7da1198bbf19e1f"), "name" : "fff", "kor" : 100, "eng" : 69, "mat" : 89, "test" : "midterm" }
{ "_id" : ObjectId("60c70b7bc7da1198bbf19e20"), "name" : "ggg", "kor" : 75, "eng" : 100, "mat" : 100, "test" : "final" }


> db.Score.find({mat:{$gte:70}}).count()
6
```



Q4. Score 이름과 국어점수를 출력하되 국어점수가 80점 이상만 출력해보자.

```javascript
> db.Score.find({kor:{$gte:80}}, {name:1, kor:1, _id:0})

{ "name" : "aaa", "kor" : 90 }
{ "name" : "bbb", "kor" : 100 }
{ "name" : "ccc", "kor" : 80 }
{ "name" : "fff", "kor" : 100 }
```

+) Score 이름과 국어점수를 출력하되 국어점수가 80점 이상 추출해서 함을 구하자.

```javascript
var sr = db.Score.find({kor:{$gte:80}}, {name:1, kor:1, _id:0})
sr
{ "name" : "aaa", "kor" : 90 }
{ "name" : "bbb", "kor" : 100 }
{ "name" : "ccc", "kor" : 80 }
{ "name" : "fff", "kor" : 100 }

print(sr)
> DBQuery: my_score.Score -> { "kor" : { "$gte" : 80 } }

> var tot=0;
> while(sr.hasNext()){
>     res = sr.next();
>     print(res.name+" : " + res.kor);
>     tot += res.kor;
>     print("tot = "+tot);
> }
> print("   tot =>  "+tot);
> sr.size()
    
    
aaa : 90
tot = 90
bbb : 100
tot = 190
ccc : 80
tot = 270
fff : 100
tot = 370
tot =>  370  // print("   tot =>  "+tot);
4 // sr.size()
```



Reference > mongo > Shell Methods > Cursor Methods 도움말 보기

db.users.find().forEach(<function>)

db.user.find().forEach(function(myDoc){print("user:" + myDoc.name);});

- db.user.find()의 결과를 forEach의 function(myDoc)가 받는다.
- 받은 결과(myDoc)의 myDoc.name이름을 호출하는 것

```javascript
> var sr02 = db.Score.find({kor:{$gte:80}}, {name:1, kor:1, _id:0});
> sr02.forEach(
> 	function(x)
>     	{
>             print(x.name + " : "+x.kor);
>         }
> );
aaa : 90
bbb : 100
ccc : 80
fff : 100

> sr02.isClosed()
true
> sr02.close()
```





Q5) test가 midterm만 출력해보자. (이름, test)

```javascript
> db.Score.find({test:"midterm"},{_id:0, name:1, test:1})
// 같은말 : db.Score.find({test:{$eq: "midterm"}}, {name:1, test:1, _id:0})
{ "name" : "aaa", "test" : "midterm" }
{ "name" : "ccc", "test" : "midterm" }
{ "name" : "ddd", "test" : "midterm" }
{ "name" : "fff", "test" : "midterm" }


> var sm = db.Score.find(); // sm이 커서 객체가 됨
> sm.forEach(function(x) {
>     if(x.test=="midterm"){
>         print(x.name+" : "+x.test);
>     }
> });

aaa : midterm
ccc : midterm
ddd : midterm
fff : midterm
```



Q6)









































